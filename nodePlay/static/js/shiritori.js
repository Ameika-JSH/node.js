$(document).ready(function(){var topBefore='40px';var topAfter='210px';var comAnsArr={};var comAns=undefined;$("#shiritoriInput").focus().keydown(function(){if(event.keyCode==13)shiritoriPlay(event,this);});function shiritoriPlay(event,thisInput){if(event.keyCode==13){var inputAns=$(thisInput).val();if(comAns==undefined||lastChar(comAns)==inputAns[0]){$("#shiritoriResult").append('<p class = "human">지구인 : '+inputAns+'</p>');if(comAnsArr[lastChar(inputAns)]==undefined){$("#loading").css('display','block');$("#shiritoriInput").attr('disabled','true');$.ajax({url:'/ajax/getDics',type:'GET',data:{val:lastChar(inputAns),str:inputAns,limit:5},success:function (json){console.log(json);if(json.cheat==1){$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 : 없는 끝글자를 쓰다니 비겁하다!</p>');shiritoriEnd(2);}else if(json.cheat==2){$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 : 그건 없는 단어야!</p>');shiritoriEnd(2);}else{data=json.data;comAnsArr[lastChar(inputAns)]=data;if(comAnsArr[lastChar(inputAns)].length==0){$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 : 내가 졌다....</p>');shiritoriEnd(1);}else{comAns=comAnsArr[lastChar(inputAns)].splice((new Date().getTime())%comAnsArr[lastChar(inputAns)].length,1)[0];$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 : '+comAns+'</p>');}}$("#shiritoriInput").removeAttr('disabled');$("#loading").css('display','none');$("#shiritoriInput").focus().val('');if(json.page>json.splint){$.ajax({url:'/ajax/getDics',type:'GET',data:{val:lastChar(inputAns),str:inputAns,limit:0},success:function (json){data=json.data;comAnsArr[lastChar(inputAns)]=comAnsArr[lastChar(inputAns)].concat(data);}});}}});}else{if(comAnsArr[lastChar(inputAns)].length==0){$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 : 내가 졌다....</p>');shiritoriEnd(1);}else{comAns=comAnsArr[lastChar(inputAns)].pop();$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 : '+comAns+'</p>');$("#shiritoriInput").focus().val('');}}}else{console.log(comAns);console.log(lastChar(comAns));alert('다음 단어의 시작은 "'+lastChar(comAns)+'" 입니다.');}}}function shiritoriEnd(win){var resultJson;if(win==1){$("#shiritoriResult").append('<p class = "human resultP">지구인 승리!!</p>');$.ajax({url:'/shiritori/result',type:'POST',data:{val:'win'},async:false ,success:function (data){resultJson=data;}});}else{$("#shiritoriResult").append('<p class = "computer resultP">컴퓨터 승리!!</p>');$.ajax({url:'/shiritori/result',type:'POST',data:{val:'lose'},async:false ,success:function (data){resultJson=data;}});}$("#inputDiv").css('height',topAfter);$("<p id = 'restartMsg'>게임이 다시 시작됩니다....( "+resultJson.win+"승 "+resultJson.lose+"패 )</p>").insertAfter('#shiritoriInput');$("#restartMsg").css('display','block');$("#shiritoriInput").attr('disabled','true').unbind().val('');var i=0;var interval=setInterval(function(){if(i==5){clearInterval(interval);$("#endCount").remove();$(".human").remove();$(".computer").remove();comAns=undefined;comAnsArr={};$("#shiritoriInput").removeAttr('disabled').keydown(function(){if(event.keyCode==13)shiritoriPlay(event,this);});;$("#restartMsg").remove();$("#inputDiv").css('height',topBefore);}else{$("#endCount").remove();$("<p id = 'endCount'>"+(5-(i++))+"</p>").insertAfter('#restartMsg');$("#endCount").fadeOut(1000);}},1000);}function lastChar(str){return str[str.length-1];}});